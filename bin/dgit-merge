#!/bin/bash
SOURCE="$(readlink -f $(dirname $BASH_SOURCE))"
source "$SOURCE/dgit-locations"
list=$(conffolder)

cd "$list"

repo=$(zenity --list --text="Choose a issue to create a working folder for" --column "Issue Name" *)
#Check that an item was chosen
if [ ! $? -o -z "$repo" ]
then
	exit 0
fi
echo "Issue $repo chosen" &>> "$dgitlog"

cd "$repo"

current=$(git branch | ssed -R '/\*/!d; s/^\*?\s+(.*)$/\1/')

branch=$(zenity --list --text="Choose a branch to merge into branch $current for this repo" --column "Branch" $(git branch | ssed -R 's/^\*?\s+(.*)$/\1/'))
if [ ! $? -o -z "$branch" ]
then
	exit 0
fi
echo "Branch $branch chosen" &>> "$dgitlog"

if git merge "$branch" &>> "$dgitlog"
then
	zenity --info --title="Success" --text="Successfully merged the changes from branch $branch into branch $current."
fi
